Test: test_book_001_subscribe_btc_depth_10[TC_BOOK_001]
Time: 2026-01-29 18:16:00.562551
================================================================================
self = <tests.test_orderbook.TestOrderbook object at 0x1085cb748>, ws_client = <utils.ws_client.WebSocketClient object at 0x108610048>
test_logger = <Logger test_book_001_subscribe_btc_depth_10[TC_BOOK_001] (DEBUG)>, save_response = <function save_response.<locals>._save at 0x108715d08>
orderbook_case = {'case_id': 'TC_BOOK_001', 'channel_type': 'orderbook', 'description': 'è®¢é˜…è®¢å•ç°¿æ•°æ® - BTC_USDT - æ·±åº¦ 10', 'expected': {'data_fields': ['bids', 'asks', 't'], 'message_count': 1, 'min_asks': 1, 'min_bids': 1, ...}, ...}
validator = <tests.conftest.validator.<locals>.ValidatorWrapper object at 0x1089ed2b0>

    @allure.story("è®¢é˜…è®¢å•ç°¿ - BTC_USDT - æ·±åº¦ 10")
    @allure.severity(allure.severity_level.CRITICAL)
    @pytest.mark.asyncio
    @pytest.mark.smoke
    @pytest.mark.parametrize("orderbook_case", ["TC_BOOK_001"], indirect=True)
    async def test_book_001_subscribe_btc_depth_10(
            self,
            ws_client,
            test_logger,
            save_response,
            orderbook_case,
            validator):
        """TC_BOOK_001: è®¢é˜…è®¢å•ç°¿æ•°æ® - BTC_USDT - æ·±åº¦ 10"""
    
        case = orderbook_case
    
        with allure.step(f"æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹: {case['case_id']} - {case['description']}"):
            test_logger.info(f"æµ‹è¯•ç”¨ä¾‹: {case['case_id']}")
            test_logger.info(f"æè¿°: {case['description']}")
            test_logger.info(f"è¯·æ±‚å‚æ•°: {case['params']}")
        # è°ƒè¯•ä¿¡æ¯
        test_logger.info(f"WebSocket URL: {ws_client.ws_url}")
        test_logger.info(f"è¶…æ—¶æ—¶é—´: {ws_client.timeout}ç§’")
        test_logger.info(f"è¿æ¥çŠ¶æ€: {await ws_client.is_connected()}")
    
        # assert ws_client.ws is not None, "WebSocket å¯¹è±¡ä¸åº”ä¸º None"
        # assert not ws_client.ws.closed, "WebSocket ä¸åº”å¤„äºå…³é—­çŠ¶æ€"
    
        await WebSocketTestHelper.execute_subscribe_test(
>           ws_client, test_logger, save_response, case, validator
        )

tests/test_orderbook.py:50: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

ws_client = <utils.ws_client.WebSocketClient object at 0x108610048>, test_logger = <Logger test_book_001_subscribe_btc_depth_10[TC_BOOK_001] (DEBUG)>
save_response = <function save_response.<locals>._save at 0x108715d08>
case = {'case_id': 'TC_BOOK_001', 'channel_type': 'orderbook', 'description': 'è®¢é˜…è®¢å•ç°¿æ•°æ® - BTC_USDT - æ·±åº¦ 10', 'expected': {'data_fields': ['bids', 'asks', 't'], 'message_count': 1, 'min_asks': 1, 'min_bids': 1, ...}, ...}
validator = <tests.conftest.validator.<locals>.ValidatorWrapper object at 0x1089ed2b0>

    @staticmethod
    async def execute_subscribe_test(
            ws_client,
            test_logger,
            save_response,
            case: Dict[str, Any],
            validator
    ):
        """
        æ‰§è¡Œè®¢é˜…æµ‹è¯•çš„é€šç”¨æµç¨‹
    
        Args:
            ws_client: WebSocket å®¢æˆ·ç«¯
            test_logger: æµ‹è¯•æ—¥å¿—
            save_response: å“åº”ä¿å­˜å‡½æ•°
            case: æµ‹è¯•ç”¨ä¾‹æ•°æ®
            validator: éªŒè¯å™¨
        """
        case_id = case['case_id']
        params = case['params']
        expected = case.get('expected', {})
    
        # æ„å»ºè®¢é˜…é¢‘é“
        instrument_name = params['instrument_name']
        depth = params['depth']
        channel = f"book.{instrument_name}.{depth}"
    
        with allure.step(f"1. è®¢é˜…é¢‘é“: {channel}"):
            test_logger.info("=" * 80)
            test_logger.info(f"ğŸ“¢ è®¢é˜…é¢‘é“: {channel}")
            test_logger.info("=" * 80)
    
            # å‘é€è®¢é˜…è¯·æ±‚
            subscribe_response = await ws_client.subscribe(
                channels=[channel],
                timeout=30
            )
    
            test_logger.info(f"è®¢é˜…ç¡®è®¤å“åº”: {subscribe_response}")
    
            # ä¿å­˜è®¢é˜…ç¡®è®¤å“åº”
            if save_response:
                save_response(
                    case_id=case_id,
                    step="subscribe_confirmation",
>                   data=subscribe_response
                )
E               TypeError: _save() got an unexpected keyword argument 'case_id'

utils/ws_test_helpers.py:59: TypeError